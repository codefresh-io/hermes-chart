version: '1.0'

steps:

  package_chart:
    title: package hermes chart
    image: codefresh/plugin-helm:2.8.1
    commands:
    - helm init --client-only
    - helm package -u hermes

  update_chart_repo:
    title: update hermes chart in repository
    image: codefresh/plugin-helm:2.8.1
    commands:
    - "VERSION=$(grep \"version: \" hermes/Chart.yaml | awk '{print $2}')"
    - PACKAGE=hermes-$VERSION.tgz
    - curl -X POST --user ${{BASIC_AUTH_USER}}:${{BASIC_AUTH_PASS}} --fail --data-binary "@$PACKAGE" ${{HELM_REPO_PATH}}
